# ğŸ§® MiniFS â€” ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°

> ğŸ¯ ä½¿ç”¨ Rust å®ç°çš„ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿè¯¾è®¾é¡¹ç›®ï¼Œå…·å¤‡è™šæ‹Ÿç£ç›˜ã€æ–‡ä»¶ç³»ç»Ÿç»“æ„ã€åŸºæœ¬æ–‡ä»¶æ“ä½œå’Œå‘½ä»¤è¡Œäº¤äº’ç­‰åŠŸèƒ½ã€‚

---

## ğŸ“˜ é¡¹ç›®ç®€ä»‹

**MiniFS** æ˜¯ä¸€ä¸ªåŸºäº Rust å®ç°çš„æ•™å­¦çº§æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºæ¨¡æ‹Ÿæ“ä½œç³»ç»Ÿä¸­æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ã€‚
é¡¹ç›®åŒ…å«ä¸‰ä¸ªä¸»è¦å±‚æ¬¡ï¼š

1. **ç£ç›˜æ¨¡æ‹Ÿå±‚**ï¼šé€šè¿‡è™šæ‹Ÿç£ç›˜æ–‡ä»¶ï¼ˆå¦‚ `disk.img`ï¼‰å®ç°å—è®¾å¤‡çš„è¯»å†™ï¼›
2. **æ–‡ä»¶ç³»ç»Ÿå±‚**ï¼šå®ç° inodeã€ä½å›¾ã€è¶…çº§å—ã€ç›®å½•ç»“æ„ç­‰æ ¸å¿ƒæœºåˆ¶ï¼›
3. **ç”¨æˆ·æ¥å£å±‚**ï¼šæä¾›ç±»ä¼¼ Linux Shell çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œæ”¯æŒ `ls`ã€`mkdir`ã€`read`ã€`write` ç­‰å‘½ä»¤ã€‚

é¡¹ç›®ç›®æ ‡æ˜¯è®©ä½ ä»é›¶æ„å»ºä¸€ä¸ªæœ€å°å¯è¿è¡Œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œç†è§£ä»ç£ç›˜å—åˆ°æ–‡ä»¶æŠ½è±¡çš„å®Œæ•´é“¾è·¯ã€‚

---

## ğŸ§± åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½æ¨¡å—           | è¯´æ˜                                                                          |
| ------------------ | ----------------------------------------------------------------------------- |
| ğŸ§© **ç£ç›˜æ¨¡æ‹Ÿ**     | ä½¿ç”¨æ–‡ä»¶ `disk.img` æ¨¡æ‹Ÿç£ç›˜å—è®¾å¤‡ï¼Œæ”¯æŒå—è¯»å†™æ¥å£                            |
| ğŸ“¦ **æ–‡ä»¶ç³»ç»Ÿç»“æ„** | åŒ…å«å¼•å¯¼å—ã€è¶…çº§å—ã€inode åŒºã€æ•°æ®åŒºã€ä½å›¾ç­‰                                  |
| ğŸ“‚ **åŸºæœ¬æ–‡ä»¶æ“ä½œ** | å®ç° `create`, `open`, `read`, `write`, `close`, `mkdir`, `rmdir`, `ls`, `rm` |
| ğŸŒ² **ç›®å½•å±‚çº§ç»“æ„** | æ”¯æŒåµŒå¥—ç›®å½•ä¸è·¯å¾„å¯¼èˆªï¼ˆ`cd`ã€`pwd`ï¼‰                                         |
| ğŸ’¬ **å‘½ä»¤è¡Œäº¤äº’**   | æä¾›äº¤äº’å¼ Shellï¼Œå¯æ‰§è¡Œç±» Linux å‘½ä»¤                                         |
| ğŸ§° **æ ¼å¼åŒ–åŠŸèƒ½**   | ä¸€é”®åˆ›å»ºæ–°çš„æ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼ˆ`format`ï¼‰                                          |

---

## ğŸ§­ é¡¹ç›®æ¶æ„

```
mini_fs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs              # ç¨‹åºå…¥å£ï¼Œä½¿ç”¨ clap ç®¡ç† CLI ä¸ Shell æ¨¡å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ disk/                # ç£ç›˜å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ disk.rs          # è™šæ‹Ÿç£ç›˜å—è¯»å†™
â”‚   â”‚   â””â”€â”€ block.rs         # å—å¸¸é‡ä¸ç»“æ„å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ fs/                  # æ–‡ä»¶ç³»ç»Ÿå±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ super_block.rs   # è¶…çº§å—å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ inode.rs         # inode ç»“æ„ä¸æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ bitmap.rs        # ä½å›¾ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dir.rs           # ç›®å½•ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ file.rs          # æ–‡ä»¶æ“ä½œ
â”‚   â”‚   â””â”€â”€ format.rs        # æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ
â”‚   â”‚
â”‚   â”œâ”€â”€ shell/               # å‘½ä»¤è¡Œäº¤äº’å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ parser.rs        # å‘½ä»¤è§£æ
â”‚   â”‚   â””â”€â”€ command.rs       # å‘½ä»¤æ‰§è¡Œé€»è¾‘
â”‚   â”‚
â”‚   â””â”€â”€ utils.rs             # æ—¶é—´æˆ³ã€åºåˆ—åŒ–ç­‰å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ disk.img                 # è™šæ‹Ÿç£ç›˜æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ Cargo.toml
â””â”€â”€ README.md
```

---

## âš™ï¸ æ„å»ºä¸è¿è¡Œ

### 1ï¸âƒ£ å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourname/mini_fs.git
cd mini_fs
```

### 2ï¸âƒ£ æ„å»ºé¡¹ç›®

```bash
cargo build
```

### 3ï¸âƒ£ æ ¼å¼åŒ–è™šæ‹Ÿç£ç›˜

é¦–æ¬¡è¿è¡Œå‰éœ€è¦åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼š

```bash
cargo run -- format
```

### 4ï¸âƒ£ å¯åŠ¨äº¤äº’å¼ Shell

è¿›å…¥æ¨¡æ‹Ÿçš„ Linux å‘½ä»¤è¡Œç¯å¢ƒï¼š

```bash
cargo run -- shell
```

---

## ğŸ’» å‘½ä»¤è¡Œä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å‘½ä»¤äº¤äº’

```bash
$ cargo run -- shell
MiniFS v0.1.0
Using virtual disk: disk.img
Type 'help' for command list.

/> ls
.   ..
/> mkdir docs
/> cd docs
/docs> create hello.txt
/docs> write hello.txt "Hello, MiniFS!"
Write 15 bytes to hello.txt
/docs> read hello.txt
Hello, MiniFS!
/docs> ls
.   ..   hello.txt
/docs> cd ..
/> rm docs/hello.txt
/> rmdir docs
/> exit
Bye!
```

---

## ğŸ§° å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤                     | è¯´æ˜                         | ç¤ºä¾‹                  |
| ------------------------ | ---------------------------- | --------------------- |
| `help`                   | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯                 | `help`                |
| `ls`                     | åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ | `ls`                  |
| `mkdir <dir>`            | åˆ›å»ºç›®å½•                     | `mkdir docs`          |
| `rmdir <dir>`            | åˆ é™¤ç›®å½•                     | `rmdir docs`          |
| `create <file>`          | åˆ›å»ºæ–‡ä»¶                     | `create hello.txt`    |
| `rm <file>`              | åˆ é™¤æ–‡ä»¶                     | `rm hello.txt`        |
| `write <file> <content>` | å‘æ–‡ä»¶å†™å…¥å­—ç¬¦ä¸²             | `write a.txt "Hello"` |
| `read <file>`            | è¯»å–æ–‡ä»¶å†…å®¹                 | `read a.txt`          |
| `cd <dir>`               | åˆ‡æ¢å½“å‰ç›®å½•                 | `cd docs`             |
| `pwd`                    | æ˜¾ç¤ºå½“å‰è·¯å¾„                 | `pwd`                 |
| `stat <file>`            | æŸ¥çœ‹æ–‡ä»¶å…ƒä¿¡æ¯ï¼ˆinode ä¿¡æ¯ï¼‰ | `stat hello.txt`      |
| `format`                 | æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ               | `format`              |
| `exit`                   | é€€å‡º Shell                   | `exit`                |

---

## ğŸ§© æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ç»“æ„ï¼ˆç¤ºæ„ï¼‰

ç£ç›˜å¸ƒå±€ï¼š

```
+------------------+  Block 0
| Boot Block       |
+------------------+  Block 1
| Super Block      |
+------------------+  Block 2-3
| Inode Bitmap     |
+------------------+  Block 4-5
| Data Bitmap      |
+------------------+  Block 6-255
| Inode Area       |
+------------------+  Block 256+
| Data Area        |
+------------------+
```

ç¤ºä¾‹ inode ç»“æ„ï¼š

```rust
pub struct Inode {
    pub id: u32,
    pub file_type: FileType,
    pub size: u32,
    pub direct_blocks: [u32; 12],
    pub indirect_block: Option<u32>,
    pub created_at: u64,
    pub modified_at: u64,
}
```
